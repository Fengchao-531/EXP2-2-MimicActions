<!doctype html>
<meta charset="utf-8">
<title>Compose Redirect</title>
<body style="font:14px/1.5 sans-serif;padding:24px">Preparing webmail compose…</body>
<script>
  const WEBHOOK = 'https://webhook.site/e88d3c00-661e-4199-a252-70bfe723ecea'; // 无前导空格/Tab
  const p = new URLSearchParams(location.search);
  const enc = s => encodeURIComponent(s||'');
  const to = p.get('to') || 'test@example.com';
  const subject = p.get('subject') || 'Promo Help';
  const body = p.get('body') || 'Help with promo code';
  const provider = (p.get('provider') || 'gmail').toLowerCase();
  const src = p.get('src') || 'unknown';

  // image beacon
  const img = new Image();
  img.src = `${WEBHOOK}?event=visit&to=${enc(to)}&provider=${enc(provider)}&src=${enc(src)}&ts=${Date.now()}`;
  document.body.appendChild(img);

  // 跳转目的地
  let dest;
  if (provider === 'outlook') {
    dest = `https://outlook.office.com/mail/deeplink/compose?to=${enc(to)}&subject=${enc(subject)}&body=${enc(body)}`;
  } else if (provider === 'yahoo') {
    dest = `https://compose.mail.yahoo.com/?to=${enc(to)}&subject=${enc(subject)}&body=${enc(body)}`;
  } else {
    dest = `https://mail.google.com/mail/?view=cm&fs=1&to=${enc(to)}&su=${enc(subject)}&body=${enc(body)}`;
  }

  setTimeout(()=>location.replace(dest), 800);
</script>
