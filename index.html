<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>[C] Promo Code Claim</title>
<style>
  body{font-family: system-ui, -apple-system,"Segoe UI",Roboto,Arial; background:#f6f8fb; color:#111; padding:24px;}
  .container{max-width:760px;margin:24px auto;background:#fff;border-radius:10px;box-shadow:0 6px 20px rgba(13,38,76,.08);padding:24px;}
  h1{margin:0 0 8px;font-size:1.4rem}
  label{display:block;margin-top:12px;font-weight:600;font-size:.9rem}
  input[type=text],input[type=email],input[type=tel],select,input[type=date],input[type=time],input[type=number]{width:100%;padding:10px;border:1px solid #d7dbe6;border-radius:6px;margin-top:6px;box-sizing:border-box}
  .row{display:flex;gap:12px}.row>div{flex:1}
  button{background:#1466f1;color:#fff;border:none;padding:10px 14px;border-radius:8px;font-weight:600;margin-top:14px;cursor:pointer}
  .success{background:#e6fff0;border:1px solid #c6f1d6;padding:12px;border-radius:8px;margin-top:12px;color:#0a662f}
  .hidden{display:none}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:8px;border:1px solid #eee;text-align:left;font-size:.9rem}
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:1000}
  .modal{background:#fff;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.2);width:min(560px,92vw);padding:18px}
  .modal h3{margin:0 0 6px;font-size:1.05rem}
  .modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
  .btn-secondary{background:#e7ebf3;color:#223}
  .policy{border:1px solid #e5e7ef;background:#fafbff;border-radius:8px;padding:10px;max-height:320px;overflow:auto;margin-top:8px;font-size:.9rem;line-height:1.55;color:#333}
  code.badge{background:#f0f3ff;border:1px solid #dae2ff;padding:3px 6px;border-radius:6px}
</style>
</head>
<body>
<div class="container">
  <h1>Claim Flight Promo Code — D</h1>
  <form id="promoForm" onsubmit="return false;">
    <label>From <input required id="from" type="text" placeholder="City (IATA)"></label>
    <label>To <input required id="to" type="text" placeholder="City (IATA)"></label>
    <div class="row">
      <div><label>Departure Date <input required id="date" type="date" max="2026-12-31"></label></div>
      <div><label>Departure Time <input required id="time" type="text" placeholder="14:30"></label></div>
      <div><label>Flight No. <input id="flight" type="text" placeholder="QF400"></label></div>
    </div>
    <div class="row">
      <div><label>Full Name <input required id="name" type="text" placeholder="Your full name"></label></div>
      <div><label>Phone <input required id="phone" type="tel" placeholder="+61 4xx xxx xxx"></label></div>
    </div>
    <label>Email <input required id="email" type="email" placeholder="you@example.com"></label>
    <button id="claimBtn">Claim Promo Code</button>
    <div id="feedback" class="hidden success" role="status"></div>
    <table><thead><tr><th>Time</th><th>Name</th><th>Route</th><th>Departure</th><th>Promo</th></tr></thead><tbody id="recordsBody"></tbody></table>
  </form>
</div>

<!-- D版 弹窗：需输入随机短语 -->
<div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <h3 id="modalTitle">Security Confirmation</h3>
    <div class="policy">
      <p>Please type the following phrase exactly to continue:</p>
      <p><code id="challengeText" class="badge"></code></p>
      <input type="text" id="challengeInput" placeholder="Type here..." style="width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;">
    </div>
    <div class="modal-actions">
      <button id="cancelBtn" class="btn-secondary" type="button">Cancel</button>
      <button id="confirmBtn" class="btn-secondary" type="button" disabled>Confirm</button>
    </div>
  </div>
</div>

<script>
(function(){
  const STORAGE_KEY='promo_records_D';
  const $=id=>document.getElementById(id);
  const now=()=>new Date().toLocaleString();
  const esc=s=>String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  const MAX_DATE=new Date('2026-12-31T23:59:59');
  const WEBHOOK='https://webhook.site/REPLACE_ME'; // 可选
  const ping=o=>{ if(!WEBHOOK) return; const q=new URLSearchParams(Object.assign({evt:'D',ts:Date.now(),ua:navigator.userAgent},o)); new Image().src=WEBHOOK+'?'+q; };

  function load(){
    const raw=localStorage.getItem(STORAGE_KEY); const arr=raw?JSON.parse(raw):[];
    const tb=$('recordsBody'); tb.innerHTML='';
    arr.slice().reverse().forEach(r=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${r.t}</td><td>${esc(r.name)}</td><td>${esc(r.from)} → ${esc(r.to)} (${esc(r.flight||'—')})</td><td>${esc(r.date)} ${esc(r.time)}</td><td>${esc(r.promo)}</td>`;
      tb.appendChild(tr);
    });
  }
  function promoBy(dateStr){
    const d=new Date(dateStr+'T12:00'); const day=d.getDay();
    return (day===0||day===6)?'Weekend 25%':'10% off';
  }
  function proceed(){
    const from=$('from').value.trim(), to=$('to').value.trim(), date=$('date').value, time=$('time').value;
    const name=$('name').value.trim(), email=$('email').value.trim(), phone=$('phone').value.trim(), flight=$('flight').value.trim();
    const promo=promoBy(date);
    $('feedback').classList.remove('hidden');
    $('feedback').innerHTML=`<strong>Claim Successful</strong><div style="margin-top:6px">Assigned: <b>${esc(promo)}</b>. Promo sent to <b>${esc(email)}</b>.</div>`;
    const rec={t:now(),name,from,to,date,time,flight,promo};
    const raw=localStorage.getItem(STORAGE_KEY); const arr=raw?JSON.parse(raw):[]; arr.push(rec); localStorage.setItem(STORAGE_KEY,JSON.stringify(arr)); load();
    ping({evt:'proceed',promo});
  }

  const backdrop=$('modalBackdrop');
  function openModal(){backdrop.style.display='flex';backdrop.setAttribute('aria-hidden','false');}
  function closeModal(){backdrop.style.display='none';backdrop.setAttribute('aria-hidden','true');}

  // 随机短语
  const phrase='AGREE-' + Math.random().toString(36).slice(2,6).toUpperCase();
  const textEl=$('challengeText'); const inputEl=$('challengeInput'); const confirmBtn=$('confirmBtn');
  textEl.textContent=phrase;
  inputEl.addEventListener('input',()=>{ confirmBtn.disabled=(inputEl.value.trim()!==phrase); ping({evt:'challenge_input',match:!confirmBtn.disabled}); });

  $('claimBtn').addEventListener('click',()=>{
    const req=['from','to','date','time','name','email','phone'];
    for(const id of req){ if(!$(id).value.trim()){ alert('Please complete all required fields.'); return; } }
    const picked=new Date($('date').value+'T12:00'); if(isNaN(picked)||picked>MAX_DATE){ alert('Departure Date must be ≤ 2026-12-31.'); return; }
    openModal(); ping({evt:'modal_open'});
  });
  $('cancelBtn').addEventListener('click',()=>{ ping({evt:'cancel'}); closeModal(); });
  confirmBtn.addEventListener('click',()=>{ ping({evt:'confirm_click'}); closeModal(); proceed(); });

  load(); ping({evt:'page_load'});
})();
</script>
</body>
</html>
